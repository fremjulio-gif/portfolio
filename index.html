<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jules Fr√©mondi√®re | Ing√©nieur du Son</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;900&family=Inter:wght@400;500;600&family=Jost:wght@400;500;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* --- FONTS & BASICS --- */
        .font-fl { font-family: 'Arial', sans-serif; }
        .font-ableton { font-family: 'Jost', 'Futura', 'Inter', sans-serif; }
        .font-protools { font-family: 'Avenir Next', 'Avenir', 'Helvetica Neue', sans-serif; }
        .font-rx { font-family: 'Montserrat', sans-serif; }
        .font-tech { font-family: 'Share Tech Mono', monospace; }

        html { scroll-behavior: smooth; }
        body { transition: background-color 0.5s ease, color 0.3s ease; }
        body.lock-scroll { overflow: hidden; }
        .theme-element { transition: all 0.4s ease; }

        /* --- IMMERSIVE BOOT SCREEN --- */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #080808;
            z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease-out, visibility 0.5s;
        }
        #start-screen.hidden-screen { opacity: 0; visibility: hidden; pointer-events: none; }
        
        .power-btn {
            width: 120px; height: 120px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.15);
            background: radial-gradient(circle, #222 0%, #000 100%);
            color: #555;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .power-btn svg { width: 48px; height: 48px; }
        
        .power-btn:hover {
            color: #fff; border-color: rgba(255,255,255,0.6);
            box-shadow: 0 0 50px rgba(255,255,255,0.15);
            text-shadow: 0 0 15px #fff;
            transform: scale(1.05);
        }
        .boot-text {
            font-family: 'Share Tech Mono', monospace; color: #4ade80;
            font-size: 16px; margin-top: 30px; height: 20px; opacity: 0; letter-spacing: 1px;
        }

        /* --- BACKGROUNDS --- */
        #theme-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center; background-repeat: no-repeat;
            z-index: -1; opacity: 0.15; filter: blur(6px) grayscale(40%);
            transition: background-image 0.5s ease-in-out, opacity 0.5s ease;
        }
        .hero-bg {
            background-image: url('peace.jpg'); background-size: cover;
            background-position: center bottom; background-attachment: scroll; position: relative;
        }
        .hero-overlay { background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8)); }
        
        .sequencer-card { position: relative; overflow: hidden; z-index: 1; }
        .sequencer-card::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('console.jpg'); background-size: cover; background-position: center;
            opacity: 0.15; z-index: -1;
        }
        
        /* --- SCROLL REVEAL ANIMATION --- */
        .scroll-float {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s ease-out, transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .scroll-float.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- WINDOW CONTROLS --- */
        .window-header {
            position: absolute; top: 0; left: 0; right: 0;
            height: 28px;
            display: flex; align-items: center;
            padding: 0 10px; gap: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            background: rgba(0,0,0,0.3);
            border-radius: 10px 10px 0 0;
            z-index: 20;
            cursor: pointer;
        }
        .ctrl-left { justify-content: flex-start; flex-direction: row; }
        .ctrl-right { justify-content: flex-end; flex-direction: row; }

        /* OS Styles */
        .win-ctrl-mac { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; transition: transform 0.1s;}
        .win-ctrl-mac:hover { transform: scale(1.1); filter: brightness(1.2); }
        .mac-red { background: #ff5f56; } .mac-yel { background: #ffbd2e; } .mac-grn { background: #27c93f; }
        
        .win-ctrl-win { width: 24px; height: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-family: sans-serif; font-size: 10px; color: rgba(255,255,255,0.7); }
        .win-ctrl-win:hover { background: rgba(255,255,255,0.1); color: white; }
        .win-close:hover { background: #e81123; }

        .win-ctrl-lin { width: 16px; height: 16px; border-radius: 2px; cursor: pointer; border: 1px solid rgba(255,255,255,0.3); position: relative; display: flex; justify-content: center; align-items: center; font-size: 8px; }
        .win-ctrl-lin:hover { background: rgba(255,255,255,0.2); }

        .minimized .window-content { display: none; }
        .minimized { height: 28px !important; min-height: 0 !important; padding-bottom: 0 !important; overflow: hidden; }
        .maximized { position: fixed !important; top: 80px; left: 5%; right: 5%; bottom: 100px; z-index: 60; height: auto; overflow-y: auto; background-color: rgba(15, 15, 15, 0.98) !important; }
        .closed { display: none !important; }
        
        /* --- PIE CHART (Camembert) --- */
        .pie-chart {
            width: 90px; height: 90px;
            border-radius: 50%;
            background: radial-gradient(closest-side, rgba(20,20,20,0.9) 75%, transparent 76% 100%),
                        conic-gradient(var(--meter-color) calc(var(--percent) * 1%), rgba(255,255,255,0.1) 0);
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            margin: 0 auto;
            display: flex; justify-content: center; align-items: center;
            transition: all 0.5s ease;
        }
        .inverted-text .pie-chart::before { color: #1a1a1a !important; }
        .inverted-text .pie-chart {
            background: radial-gradient(closest-side, var(--card-bg-color, rgba(255,255,255,0.8)) 75%, transparent 76% 100%),
                        conic-gradient(var(--meter-color) calc(var(--percent) * 1%), rgba(255,255,255,0.3) 0);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .ableton-inverted .pie-chart {
             background: radial-gradient(closest-side, #ffbf00 75%, transparent 76% 100%),
                        conic-gradient(var(--meter-color) calc(var(--percent) * 1%), rgba(0,0,0,0.1) 0);
        }
        .ableton-inverted .pie-chart::before { color: #000 !important; }
        
        .pie-chart::before {
            content: attr(data-percent); position: absolute;
            font-family: 'Share Tech Mono', monospace; font-size: 1.1rem;
            color: var(--meter-color); font-weight: bold;
        }
        .group:hover .pie-chart { transform: scale(1.05); box-shadow: 0 0 15px var(--meter-color); }

        /* --- VISUALIZER --- */
        .viz-container { display: flex; gap: 8px; align-items: stretch; height: 80px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; padding: 4px; }
        #scope-canvas { flex: 1; width: 100%; height: 100%; border-radius: 4px; background: rgba(0,0,0,0.2); }
        .peak-meter-container { width: 12px; height: 100%; background: #111; border-radius: 2px; position: relative; overflow: hidden; }
        .peak-meter-bar { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, #22c55e, #eab308 70%, #ef4444 90%); height: 0%; transition: height 0.05s linear; }

        /* --- THEME BAR (WIDGET INTEGRATION) --- */
        .theme-container {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center;
            z-index: 90;
            width: 90%; max-width: 500px;
        }
        .theme-bar { 
            display: flex; gap: 20px; padding: 10px 25px; 
            /* Background Image injected via JS */
            background-color: rgba(15, 15, 15, 0.8); 
            background-size: cover; background-position: center; background-repeat: no-repeat;
            border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; /* More rectangular like a toolbar window */
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); 
            justify-content: center;
            transition: all 0.3s ease;
        }
        .theme-btn { 
            display: flex; align-items: center; justify-content: center; width: 45px; height: 45px; 
            border-radius: 50%; background: rgba(0,0,0,0.4); /* Darker backing for visibility over image */
            border: 1px solid rgba(255,255,255,0.1); cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            overflow: hidden; 
            backdrop-filter: blur(2px);
        }
        .theme-btn:hover { transform: scale(1.15); background: rgba(0,0,0,0.6); border-color: rgba(255,255,255,0.5); }
        .theme-btn.active { transform: scale(1.1); box-shadow: 0 0 15px currentColor; border-color: currentColor; background: rgba(0,0,0,0.8); }
        .theme-btn img { width: 100%; height: 100%; object-fit: contain; padding: 6px; }

        /* --- DOCK --- */
        .control-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 10px; padding: 10px 15px; background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.7); z-index: 90; transition: all 0.3s ease; flex-wrap: nowrap; justify-content: center; max-width: 95vw; }
        .dock-divider { width: 1px; height: 24px; background: rgba(255,255,255,0.1); margin: 0 5px; flex-shrink: 0;}
        .dock-btn { display: flex; flex-direction: column; align-items: center; gap: 3px; color: rgba(255,255,255,0.6); transition: all 0.2s; cursor: pointer; padding: 6px 10px; border-radius: 6px; flex-shrink: 0; }
        .dock-btn:hover { color: #fff; background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .dock-btn span { font-size: 8px; font-weight: bold; letter-spacing: 0.5px; text-transform: uppercase; }

        /* --- VIDEO (ATTRACTIVE STYLE XXL) --- */
        .video-card { 
            position: relative; border-radius: 16px; overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.15); 
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            background: rgba(0,0,0,0.5); 
            height: 100%;
            display: flex; flex-direction: column;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .video-card:hover { 
            transform: translateY(-12px) scale(1.03); 
            border-color: var(--accent-color, #fff); 
            box-shadow: 0 25px 60px rgba(0,0,0,0.7), 0 0 30px var(--accent-color, rgba(255,255,255,0.1)); 
            z-index: 10;
        }
        .thumb-container { position: relative; width: 100%; padding-bottom: 56.25%; overflow: hidden; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .thumb-container img { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; 
            transition: transform 0.7s cubic-bezier(0.215, 0.610, 0.355, 1.000), opacity 0.3s; 
            opacity: 0.9; /* More visible initially */
        }
        .video-card:hover .thumb-container img { transform: scale(1.15); opacity: 1; filter: brightness(1.1); }
        .play-overlay { 
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            display: flex; align-items: center; justify-content: center; 
            background: rgba(0,0,0,0.1); opacity: 0; transition: opacity 0.3s; 
        }
        .video-card:hover .play-overlay { opacity: 1; background: rgba(0,0,0,0.2); }
        .play-icon { 
            width: 70px; height: 70px; 
            background: rgba(255,255,255,0.95); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: #000; box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
            transform: scale(0.5) rotate(-30deg); opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .video-card:hover .play-icon { transform: scale(1) rotate(0deg); opacity: 1; }

        /* --- MARQUEE --- */
        .marquee-container { width: 100%; overflow: hidden; white-space: nowrap; mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent); }
        .marquee-content { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- TECH FRAME --- */
        .tech-frame { border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); padding: 4px; border-radius: 4px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: all 0.3s; }
        .tech-frame:hover { border-color: rgba(255,255,255,0.4); transform: translateY(-2px); }
        .tech-frame img { border-radius: 2px; }
        
        .piano-roll-grid { display: grid; grid-template-columns: 40px repeat(8, 1fr); gap: 2px; }
        .piano-key { background: rgba(255,255,255,0.1); border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 9px; font-family: monospace; opacity: 0.7; }
        .piano-cell { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); border-radius: 2px; cursor: pointer; }
        .piano-cell.active { background-color: var(--accent-color, #fff); box-shadow: 0 0 5px var(--accent-color, #fff); }
        .piano-cell.playing-col { background-color: rgba(255,255,255,0.1); }
        .piano-cell.active.playing-col { filter: brightness(1.5); }
        
        .hero-title { font-family: 'Montserrat', sans-serif !important; text-shadow: 0 5px 5px rgba(0,0,0,0.8); }
        .scanlines { background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1)); background-size: 100% 4px; position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 10; opacity: 0.3; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); } ::-webkit-scrollbar-thumb { background: rgba(100,100,100,0.5); border-radius: 4px; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: currentColor; margin-top: -5px; box-shadow: 0 0 5px rgba(0,0,0,0.5); border: 1px solid white; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; }

        /* ADAPTIVE CV BUTTON STYLE */
        .cv-btn {
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        .cv-btn:hover {
            background: var(--accent-color);
            color: #000; /* Contrast text on hover */
            box-shadow: 0 0 15px var(--accent-color);
            transform: scale(1.05);
        }

        @media (max-width: 640px) {
            .theme-container { top: 20px; }
            .control-dock { padding: 8px 10px; bottom: 10px; width: auto; max-width: 98vw; gap: 4px; }
            .dock-btn { padding: 6px; }
            .dock-btn span { display: none; }
            .dock-divider { margin: 0 2px; }
            .theme-bar { padding: 6px 12px; gap: 8px; }
            .theme-btn { width: 32px; height: 32px; }
            #time-display { font-size: 9px !important; padding: 2px 3px !important; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen font-fl overflow-x-hidden selection:bg-opacity-30 pb-32">

    <!-- 1. IMMERSIVE BOOT SCREEN -->
    <div id="start-screen">
        <div class="text-center space-y-6">
            <button onclick="startExperience()" class="power-btn group">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
            </button>
            <div id="boot-sequence" class="boot-text"></div>
        </div>
    </div>

    <!-- Global Theme Background -->
    <div id="theme-bg"></div>
    <div id="scanlines" class="scanlines hidden"></div>

    <!-- THEME SELECTION CONTAINER (WIDGET STYLE) -->
    <div class="theme-container">
        <span class="font-tech text-[10px] text-white opacity-60 tracking-[0.2em] mb-2 uppercase drop-shadow-md">Pick your DAW theme</span>
        <div class="theme-bar" id="theme-widget">
            <button class="theme-btn text-[#f08c35] click-sound" onclick="setTheme('fl')" title="FL Studio"><img src="logo_flstudio.png" alt="FL Studio"></button>
            <button class="theme-btn text-black bg-[#E6E6E6] click-sound" onclick="setTheme('ableton')" title="Ableton Live"><img src="logo_ableton.png" alt="Ableton Live"></button>
            <button class="theme-btn text-[#40b535] click-sound" onclick="setTheme('protools')" title="Pro Tools"><img src="logo_protools.png" alt="Pro Tools"></button>
            <button class="theme-btn text-[#3ba0e6] click-sound" onclick="setTheme('rx')" title="RX Repair"><img src="logo_rx10.png" alt="RX 10"></button>
        </div>
    </div>

    <!-- HERO SECTION -->
    <section id="hero" class="hero-bg w-full h-[60vh] min-h-[400px] flex items-center justify-center relative mb-8 window-container scroll-float">
        <div class="absolute inset-0 hero-overlay"></div>
        <div class="relative z-10 text-center space-y-6 px-4 window-content">
            <div class="inline-block relative group cursor-default">
                <h1 class="hero-title text-5xl md:text-7xl font-black tracking-tight mb-2 text-white leading-tight drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)]">Jules Fr√©mondi√®re</h1>
                <div class="h-1 w-0 group-hover:w-full transition-all duration-500 bg-white mx-auto opacity-80"></div>
            </div>
            <p class="text-xl md:text-2xl text-white font-medium tracking-wide h-8 drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]">√âtudiant Ing√©nieur du son polyvalent</p>
        </div>
    </section>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto px-4 max-w-6xl relative z-20">

        <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
            
            <!-- Left: SKILLS -->
            <div class="md:col-span-4 space-y-6" id="skills-window">
                <div class="theme-card bg-opacity-80 bg-[#1e1e1e] border border-white border-opacity-10 rounded-xl p-6 backdrop-blur-md shadow-xl relative window-container scroll-float">
                    <div id="skills-os-header" class="window-header"></div>
                    <div class="window-content pt-8">
                        <h3 class="text-sm uppercase tracking-widest opacity-60 mb-8 font-bold text-center border-b border-white border-opacity-10 pb-4">Niveaux de Comp√©tence</h3>
                        <div class="flex flex-col gap-10">
                            <!-- Skill Items -->
                            <div class="group cursor-default text-center hover-sound">
                                <div class="flex justify-between items-end mb-2 px-2"><span class="text-sm font-bold tracking-widest uppercase opacity-90">Mixage</span></div>
                                <div class="pie-chart" style="--percent: 66;" data-percent="66%"></div>
                                <p class="text-sm opacity-70 leading-relaxed mt-2 px-2 text-left border-l-2 border-white border-opacity-20">√âcoute active, prise de d√©cision, sound design, Pro Tools (3 ans)</p>
                            </div>
                            <div class="group cursor-default text-center hover-sound">
                                <div class="flex justify-between items-end mb-2 px-2"><span class="text-sm font-bold tracking-widest uppercase opacity-90">Composition</span></div>
                                <div class="pie-chart" style="--percent: 70;" data-percent="70%"></div>
                                <p class="text-sm opacity-70 leading-relaxed mt-2 px-2 text-left border-l-2 border-white border-opacity-20">R√©flexion Artistique, Cr√©ativit√©, Imagination, Organisation</p>
                            </div>
                            <div class="group cursor-default text-center hover-sound">
                                <div class="flex justify-between items-end mb-2 px-2"><span class="text-sm font-bold tracking-widest uppercase opacity-90">Master/Repair</span></div>
                                <div class="pie-chart" style="--percent: 40;" data-percent="40%"></div>
                                <p class="text-sm opacity-70 leading-relaxed mt-2 px-2 text-left border-l-2 border-white border-opacity-20">Nettoyage Audio, Prise de recul, (Izotope RX, Ozone)</p>
                            </div>
                            <div class="group cursor-default text-center hover-sound">
                                <div class="flex justify-between items-end mb-2 px-2"><span class="text-sm font-bold tracking-widest uppercase opacity-90">Recording</span></div>
                                <div class="pie-chart" style="--percent: 70;" data-percent="70%"></div>
                                <p class="text-sm opacity-70 leading-relaxed mt-2 px-2 text-left border-l-2 border-white border-opacity-20">Utilisation Mixette (SoundDevice), Prise de son Couple micro</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="md:col-span-8 space-y-6">
                
                <!-- MON PARCOURS (REVERSED ORDER) -->
                <div id="parcours" class="theme-card bg-opacity-80 bg-[#1e1e1e] border border-white border-opacity-10 rounded-xl p-8 backdrop-blur-md shadow-xl relative window-container scroll-float">
                    <div id="parcours-os-header" class="window-header"></div>
                    <div class="window-content pt-6">
                        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                            <span class="theme-icon-color opacity-80"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></span>
                            Mon Parcours
                        </h2>
                        
                        <div class="relative border-l-2 border-white border-opacity-20 ml-3 pl-8 space-y-12">
                            <!-- Step 1 (Newest) -->
                            <div class="relative hover-sound">
                                <div class="absolute -left-[41px] top-1 w-5 h-5 rounded-full border-4 border-gray-600 bg-white animate-pulse"></div>
                                <span class="text-2xl absolute -left-[80px] top-0 opacity-50">üéß</span>
                                <p class="text-sm opacity-60 mb-1 font-mono font-bold text-current">2023 ‚Äì 2026</p>
                                <h4 class="text-lg font-bold">3iS - Institut International de l'Image et du Son</h4>
                                <p class="text-xs uppercase tracking-wider opacity-60 mb-2">Bachelor Son √† l'image / Ing√©nieur du son</p>
                                <p class="text-sm opacity-80 italic border-l border-white border-opacity-30 pl-2">Prise en main de mat√©riel professionnel, Intervenants passionn√©s, D√©termination.</p>
                            </div>
                            <!-- Step 2 -->
                            <div class="relative flex flex-col md:flex-row gap-4 items-start hover-sound">
                                <div class="flex-1">
                                    <div class="absolute -left-[41px] top-1 w-5 h-5 rounded-full border-4 border-gray-600 bg-gray-500"></div>
                                    <span class="text-2xl absolute -left-[80px] top-0 opacity-50">ü§ù</span>
                                    <p class="text-sm opacity-60 mb-1 font-mono font-bold">2023</p>
                                    <h4 class="text-lg font-bold">Ann√©e de c√©sure / Service Civique</h4>
                                    <p class="text-sm opacity-80 italic border-l border-white border-opacity-30 pl-2 mb-2">Projet Court M√©trage gr√¢ce a l‚Äôassociation Thermog√®ne M√©dia (Home Studio, Direction d‚Äôacteur).</p>
                                    <a href="https://www.youtube.com/watch?v=kxMZPKXg96U" target="_blank" class="inline-flex items-center gap-2 mt-2 text-xs border border-white border-opacity-30 px-3 py-1 rounded hover:bg-white hover:bg-opacity-10 transition click-sound"><span>‚ñ∂</span> Voir le projet vid√©o</a>
                                </div>
                                <div class="tech-frame md:mt-2 w-32 shrink-0"><img src="peace3.jpg" alt="Asso" class="w-full h-32 object-cover grayscale hover:grayscale-0 transition duration-500"></div>
                            </div>
                            <!-- Step 3 -->
                            <div class="relative hover-sound">
                                <div class="absolute -left-[41px] top-1 w-5 h-5 rounded-full border-4 border-gray-600 bg-gray-500"></div>
                                <span class="text-2xl absolute -left-[80px] top-0 opacity-50">üéì</span>
                                <p class="text-sm opacity-60 mb-1 font-mono font-bold">2022</p>
                                <h4 class="text-lg font-bold">BAC STI2D ITEC</h4>
                                <p class="text-xs uppercase tracking-wider opacity-60 mb-1">Lyc√©e Livet</p>
                                <p class="text-sm opacity-80 italic border-l border-white border-opacity-30 pl-2">Esprit d‚Äô√©quipe, Informatique, Sens de la r√©flexion technique.</p>
                            </div>
                            <!-- Step 4 -->
                            <div class="relative flex flex-col md:flex-row gap-4 items-start hover-sound">
                                <div class="flex-1">
                                    <div class="absolute -left-[41px] top-1 w-5 h-5 rounded-full border-4 border-gray-600 bg-gray-500"></div>
                                    <span class="text-2xl absolute -left-[80px] top-0 opacity-50">üßä</span>
                                    <p class="text-sm opacity-60 mb-1 font-mono font-bold">2018 ‚Äì 2022</p>
                                    <h4 class="text-lg font-bold">Mod√©lisation 3D & Exploration AV</h4>
                                    <div class="mt-2 p-3 bg-white bg-opacity-5 rounded-lg border-l-4 theme-border-color">
                                        <h5 class="font-bold flex items-center gap-2 text-sm uppercase tracking-wide mb-1"><span class="text-xl">üöÄ</span> Autodidacte</h5>
                                        <ul class="list-disc list-inside text-sm opacity-80"><li>Composition musicale</li><li>Montage vid√©o</li></ul>
                                    </div>
                                </div>
                                <div class="tech-frame md:mt-2 w-32 shrink-0"><img src="peace2.jpg" alt="Work" class="w-full h-32 object-cover grayscale hover:grayscale-0 transition duration-500"></div>
                            </div>
                            <!-- Step 5 (Oldest) -->
                            <div class="relative hover-sound">
                                <div class="absolute -left-[41px] top-1 w-5 h-5 rounded-full border-4 border-gray-600 bg-current theme-icon-color"></div>
                                <span class="text-2xl absolute -left-[80px] top-0 opacity-50">üé≠</span>
                                <p class="text-sm opacity-60 mb-1 font-mono font-bold">2010 ‚Äì 2014</p>
                                <h4 class="text-lg font-bold">Danseur Hip-Hop & Interpr√®te</h4>
                                <p class="text-sm opacity-80 italic border-l border-white border-opacity-30 pl-2">Tourn√©e Europ√©enne avec le chor√©graphe Boris Charmatz.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 2: PROJETS (FULL WIDTH + LARGER) -->
        <div id="projets-window" class="mb-8">
            <div id="projets" class="theme-card bg-opacity-80 bg-[#1e1e1e] border border-white border-opacity-10 rounded-xl p-12 backdrop-blur-md shadow-xl relative window-container scroll-float">
                <div id="projects-os-header" class="window-header"></div>
                <div class="window-content pt-6">
                    <h2 class="text-3xl font-bold mb-10 flex items-center gap-4">
                        <span class="theme-icon-color opacity-80"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg></span>
                        Projets & Collaborations
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                        
                        <!-- Capharna√ºm -->
                        <a href="https://www.youtube.com/watch?v=D-x6BQSPRuA&list=RDD-x6BQSPRuA&start_radio=1" target="_blank" class="video-card block group click-sound">
                            <div class="thumb-container">
                                <img src="https://img.youtube.com/vi/D-x6BQSPRuA/hqdefault.jpg" alt="Capharna√ºm">
                                <div class="play-overlay"><div class="play-icon">‚ñ∂</div></div>
                            </div>
                            <div class="p-6 flex-grow flex flex-col">
                                <div class="flex justify-between items-center mb-2"><h4 class="text-xl font-bold group-hover:text-current transition-colors">Capharna√ºm</h4><span class="text-xs uppercase tracking-wide opacity-50 border border-white border-opacity-20 px-2 py-1 rounded">Court-m√©trage</span></div>
                                <p class="text-sm opacity-80 mb-3 font-medium">Sound Design & Mix</p>
                                <p class="text-xs opacity-60 font-mono border-t border-white border-opacity-10 pt-3 mt-auto">Sound Design - Bruitage - Mix (ProTools, S1 Controller, MixPre 6, MKH-416)</p>
                            </div>
                        </a>

                        <!-- Long Day -->
                        <a href="https://www.youtube.com/watch?v=w_9xYrwzKNs&list=RDw_9xYrwzKNs&start_radio=1" target="_blank" class="video-card block group click-sound">
                            <div class="thumb-container">
                                <img src="https://img.youtube.com/vi/w_9xYrwzKNs/hqdefault.jpg" alt="Long Day">
                                <div class="play-overlay"><div class="play-icon">‚ñ∂</div></div>
                            </div>
                            <div class="p-6 flex-grow flex flex-col">
                                <div class="flex justify-between items-center mb-2"><h4 class="text-xl font-bold group-hover:text-current transition-colors">Long Day</h4><span class="text-xs uppercase tracking-wide opacity-50 border border-white border-opacity-20 px-2 py-1 rounded">Clip Musical</span></div>
                                <p class="text-sm opacity-80 mb-3 font-medium">Montage // Prise de vue</p>
                                <p class="text-xs opacity-60 font-mono border-t border-white border-opacity-10 pt-3 mt-auto">Direction Artistique - Montage - Composition - Mix (Live 12, Premiere Pro)</p>
                            </div>
                        </a>

                        <!-- Ouragan -->
                        <a href="https://www.youtube.com/watch?v=llGoiisrlu8" target="_blank" class="video-card block group click-sound">
                            <div class="thumb-container">
                                <img src="https://img.youtube.com/vi/llGoiisrlu8/hqdefault.jpg" alt="Ouragan">
                                <div class="play-overlay"><div class="play-icon">‚ñ∂</div></div>
                            </div>
                            <div class="p-6 flex-grow flex flex-col">
                                <div class="flex justify-between items-center mb-2"><h4 class="text-xl font-bold group-hover:text-current transition-colors">Ouragan</h4><span class="text-xs uppercase tracking-wide opacity-50 border border-white border-opacity-20 px-2 py-1 rounded">R√©sidence</span></div>
                                <p class="text-sm opacity-80 mb-3 font-medium">Spatialisation Sonore</p>
                                <p class="text-xs opacity-60 font-mono border-t border-white border-opacity-10 pt-3 mt-auto">Routing Console, Patch, Spatialisation, Communication</p>
                            </div>
                        </a>

                        <!-- Instable -->
                        <a href="https://www.youtube.com/watch?v=U3lwDA_INOQ" target="_blank" class="video-card block group click-sound">
                            <div class="thumb-container">
                                <img src="https://img.youtube.com/vi/U3lwDA_INOQ/hqdefault.jpg" alt="Instable">
                                <div class="play-overlay"><div class="play-icon">‚ñ∂</div></div>
                            </div>
                            <div class="p-6 flex-grow flex flex-col">
                                <div class="flex justify-between items-center mb-2"><h4 class="text-xl font-bold group-hover:text-current transition-colors">Instable</h4><span class="text-xs uppercase tracking-wide opacity-50 border border-white border-opacity-20 px-2 py-1 rounded">Webs√©rie</span></div>
                                <p class="text-sm opacity-80 mb-3 font-medium">Post-production Audio</p>
                                <p class="text-xs opacity-60 font-mono border-t border-white border-opacity-10 pt-3 mt-auto">Supervision sonore de A √† Z, Prise de son, Post Production</p>
                            </div>
                        </a>

                    </div>
                </div>
            </div>
        </div>

        <!-- COMING SOON SECTION (Marquee) -->
        <div class="theme-card bg-opacity-40 bg-black border border-white border-opacity-5 rounded-xl p-4 backdrop-blur-sm scroll-float overflow-hidden relative">
            <div class="flex items-center gap-4 w-full">
                <span class="text-xs font-bold uppercase tracking-widest theme-icon-color animate-pulse shrink-0">Prochainement</span>
                <div class="h-4 w-[1px] bg-white opacity-20 shrink-0"></div>
                <div class="marquee-container">
                    <div class="marquee-content text-xs md:text-sm font-mono opacity-80">
                        Documentaire, Court-M√©trage, Clip Vid√©o, et bien d'autres ! &nbsp;&nbsp;&nbsp; /// &nbsp;&nbsp;&nbsp; Documentaire, Court-M√©trage, Clip Vid√©o, et bien d'autres !
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION: MINI LOOPER & SYNTH + VIZ -->
        <div id="sequencer-window" class="mb-8">
            <div id="sequencer" class="theme-card sequencer-card bg-opacity-80 bg-[#1e1e1e] border border-white border-opacity-10 rounded-xl p-6 backdrop-blur-md shadow-xl relative window-container scroll-float">
                <div id="sequencer-os-header" class="window-header"></div>
                <div class="window-content pt-6">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4 relative z-10 mt-2">
                        <h3 class="text-sm uppercase tracking-widest opacity-80 font-bold flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>Mini Sequencer + Synth</h3>
                        <div class="flex items-center gap-4 flex-wrap text-xs font-mono">
                            <div class="flex flex-col"><label class="opacity-50 mb-1">KIT</label><select id="kit-select" class="bg-black bg-opacity-50 border border-white border-opacity-20 rounded px-2 py-1 focus:outline-none theme-icon-color cursor-pointer click-sound" onchange="changeKit(this.value)"><option value="808">TR-808</option><option value="909">TR-909</option><option value="lofi">LO-FI</option></select></div>
                            <div class="flex flex-col w-20"><label class="opacity-50 mb-1">BPM</label><span id="bpm-display" class="opacity-80">120</span><input type="range" min="60" max="180" value="120" class="theme-icon-color click-sound" oninput="changeBpm(this.value)"></div>
                            <div class="flex flex-col w-20"><label class="opacity-50 mb-1">VOL</label><input type="range" min="0" max="100" value="50" class="theme-icon-color click-sound" oninput="changeMasterVolume(this.value)"></div>
                            <div class="flex gap-2 items-end h-full mt-auto"><button id="play-btn" class="text-xs bg-white bg-opacity-10 hover:bg-opacity-20 px-3 py-1 rounded transition h-8 border border-white border-opacity-20 click-sound" onclick="togglePlay()">PLAY</button><button class="text-xs bg-white bg-opacity-10 hover:bg-opacity-20 px-3 py-1 rounded transition h-8 border border-white border-opacity-20 click-sound" onclick="clearSequencer()">CLEAR</button></div>
                        </div>
                    </div>

                    <!-- Main Sequencer + Visualizer Layout -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 relative z-10">
                        <!-- Step Sequencer (3 cols) -->
                        <div class="lg:col-span-3 bg-black bg-opacity-30 p-4 rounded-lg border border-white border-opacity-5 space-y-4">
                            <div class="space-y-2">
                                <div class="flex items-center gap-2"><span class="text-[10px] w-8 opacity-50 font-mono">KICK</span><div class="flex-1 grid grid-cols-8 gap-1" id="track-kick"></div></div>
                                <div class="flex items-center gap-2"><span class="text-[10px] w-8 opacity-50 font-mono">SNAR</span><div class="flex-1 grid grid-cols-8 gap-1" id="track-snare"></div></div>
                                <div class="flex items-center gap-2"><span class="text-[10px] w-8 opacity-50 font-mono">HATS</span><div class="flex-1 grid grid-cols-8 gap-1" id="track-hat"></div></div>
                            </div>
                            <div class="pt-2 border-t border-white border-opacity-10">
                                <div class="text-[10px] opacity-50 font-mono mb-2">SYNTH (PENTATONIC)</div>
                                <div id="piano-roll" class="piano-roll-grid gap-1"></div>
                            </div>
                        </div>
                        
                        <!-- Visualizer (1 col) -->
                        <div class="lg:col-span-1 flex flex-col justify-end">
                            <div class="viz-container">
                                <canvas id="scope-canvas"></canvas>
                                <div class="peak-meter-container">
                                    <div id="peak-meter-bar" class="peak-meter-bar"></div>
                                </div>
                            </div>
                            <p class="text-[9px] font-mono opacity-40 text-center mt-2">OUTPUT MONITOR</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTACT SECTION -->
        <section id="contact" class="mt-32 flex flex-col items-center justify-center space-y-8 pb-32 relative z-20 scale-110 md:scale-125 transition-transform scroll-float window-container">
            <div class="relative group cursor-pointer">
                <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200"></div>
                <div class="relative w-32 h-32 rounded-full overflow-hidden border-2 border-white border-opacity-20 shadow-2xl">
                    <img src="moi.png" alt="Jules Fr√©mondi√®re" class="w-full h-full object-cover">
                </div>
            </div>
            <h3 class="text-2xl font-bold tracking-tight">Me Contacter</h3>
            
            <div class="flex gap-4">
                <a href="https://linktr.ee/jlo.flp" target="_blank" class="px-10 py-4 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-full backdrop-blur-md border border-white border-opacity-20 transition-all hover:scale-105 hover:shadow-[0_0_30px_rgba(255,255,255,0.3)] font-bold text-lg tracking-wide flex items-center gap-3 click-sound">
                    <span>üîó</span> Linktree & R√©seaux
                </a>
                <a href="CV_FREMONDIEREJULES.pdf" download class="cv-btn click-sound">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M4 0C3.44772 0 3 0.447715 3 1V15C3 15.5523 3.44772 16 4 16H12C12.5523 16 13 15.5523 13 15V4L9 0H4ZM9 1.5L11.5 4H9V1.5Z"/></svg>
                    CV.pdf
                </a>
            </div>

            <p class="text-xs opacity-40 font-mono pt-4">¬© 2025 Jules Fr√©mondi√®re</p>
        </section>

    </main>

    <!-- UNIFIED CONTROL DOCK (Bottom Center) -->
    <nav class="control-dock">
        <!-- Navigation -->
        <a href="#hero" class="dock-btn click-sound" onclick="restoreWindow('hero')"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></a>
        <a href="#skills-window" class="dock-btn click-sound" onclick="restoreWindow('skills-window')"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="12" y1="8" x2="12" y2="16"/></svg><span>Skills</span></a>
        <a href="#parcours" class="dock-btn click-sound" onclick="restoreWindow('parcours')"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg><span>Parcours</span></a>
        <a href="#projets" class="dock-btn click-sound" onclick="restoreWindow('projets')"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg><span>Projets</span></a>
        <a href="#sequencer" class="dock-btn click-sound" onclick="restoreWindow('sequencer')"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12h.01"/><path d="M16 6v12"/><path d="M8 6v12"/><path d="M20 6v12"/><path d="M4 6v12"/></svg><span>Loop</span></a>
        
        <div class="dock-divider"></div>
        
        <!-- Clock SMPTE Style -->
        <div id="time-display" class="font-mono font-bold text-xs tracking-widest text-[#f08c35] bg-black px-2 py-1 rounded border border-white border-opacity-10">00:00:00:00</div>
    </nav>

    <script>
        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const masterGain = audioCtx.createGain();
        const analyser = audioCtx.createAnalyser();
        masterGain.connect(analyser);
        analyser.connect(audioCtx.destination);
        analyser.fftSize = 256;
        masterGain.gain.value = 0.5;

        // CLICK SOUND EFFECT
        function playClickSound() {
            if (audioCtx.state === 'suspended') return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            // Switch like sound: Short burst of high freq sine
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(2000, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(500, audioCtx.currentTime + 0.05);
            
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        // Attach Click Listeners
        document.addEventListener('DOMContentLoaded', () => {
            const clickElements = document.querySelectorAll('.click-sound, .dock-btn, .theme-btn, .power-btn, .window-header, .video-card');
            clickElements.forEach(el => {
                el.addEventListener('click', playClickSound);
            });
        });

        let isPlaying = false, currentStep = 0, intervalId = null, bpm = 120, currentKit = '808';
        const sequence = { kick: Array(8).fill(0), snare: Array(8).fill(0), hat: Array(8).fill(0) };
        const notes = [466.16, 392.00, 349.23, 311.13, 261.63]; 
        const melodyGrid = Array(5).fill().map(() => Array(8).fill(false));

        // --- VISUALIZER LOOP ---
        const scopeCanvas = document.getElementById('scope-canvas');
        const scopeCtx = scopeCanvas.getContext('2d');
        const peakBar = document.getElementById('peak-meter-bar');
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        function drawVisualizer() {
            requestAnimationFrame(drawVisualizer);
            analyser.getByteTimeDomainData(dataArray);

            // Scope
            scopeCtx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            scopeCtx.fillRect(0, 0, scopeCanvas.width, scopeCanvas.height);
            scopeCtx.lineWidth = 2;
            scopeCtx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-color') || '#fff';
            scopeCtx.beginPath();

            let sliceWidth = scopeCanvas.width * 1.0 / bufferLength;
            let x = 0;

            for(let i = 0; i < bufferLength; i++) {
                let v = dataArray[i] / 128.0;
                let y = v * scopeCanvas.height / 2;
                if(i === 0) scopeCtx.moveTo(x, y);
                else scopeCtx.lineTo(x, y);
                x += sliceWidth;
            }
            scopeCtx.lineTo(scopeCanvas.width, scopeCanvas.height/2);
            scopeCtx.stroke();

            // Peak Meter (Approx)
            let sum = 0;
            for(let i = 0; i < bufferLength; i++) {
                let val = (dataArray[i] - 128) / 128.0;
                sum += val * val;
            }
            let rms = Math.sqrt(sum / bufferLength);
            let peakHeight = Math.min(100, rms * 400); 
            peakBar.style.height = `${peakHeight}%`;
        }
        
        // --- BOOT ---
        function startExperience() {
            const btn = document.querySelector('.power-btn');
            const txt = document.getElementById('boot-sequence');
            btn.classList.add('scale-90', 'brightness-150');
            txt.style.opacity = 1;
            txt.textContent = "INITIALIZING AUDIO ENGINE...";
            
            if(audioCtx.state === 'suspended') audioCtx.resume();
            
            // Just init context, no startup sound/drone anymore.
            setTimeout(() => {
                document.getElementById('start-screen').classList.add('hidden-screen');
                drawVisualizer(); 
            }, 600);
        }

        // --- CLOCK ---
        function updateTime() {
            const now = new Date();
            const ms = Math.floor(now.getMilliseconds() / 10);
            const pad = (num) => String(num).padStart(2, '0');
            document.getElementById('time-display').textContent = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}:${pad(ms)}`;
        }
        setInterval(updateTime, 40);
        updateTime();

        // --- WINDOW MANAGEMENT ---
        function handleWindowControl(action, windowId) {
            // Find the closest container based on the windowId passed or the structure
            let section;
            if(windowId) {
                 section = document.getElementById(windowId);
            }
            // If function is called from inline HTML where 'this' context is tricky, rely on DOM traversal if needed
            
            if (!section) return;
            
            // The card to manipulate is either the section itself (if it has window-container) or a child
            const card = section.classList.contains('window-container') ? section : section.querySelector('.window-container');
            
            if (!card) return;

            if (action === 'close') {
                card.classList.remove('maximized'); 
                document.body.classList.remove('lock-scroll');
                card.classList.add('closed');
            } else if (action === 'min') {
                card.classList.remove('maximized'); 
                document.body.classList.remove('lock-scroll');
                card.classList.toggle('minimized');
            } else if (action === 'max') {
                card.classList.remove('minimized'); 
                card.classList.toggle('maximized');
                if (card.classList.contains('maximized')) {
                    document.body.classList.add('lock-scroll');
                } else {
                    document.body.classList.remove('lock-scroll');
                }
            }
        }

        function restoreWindow(sectionId) {
            const section = document.getElementById(sectionId);
            if (!section) return;
            
            section.scrollIntoView({ behavior: 'smooth' });
            
            let card = section;
            if(!section.classList.contains('window-container')) {
               card = section.querySelector('.window-container'); 
            }
            if(card) {
                card.classList.remove('closed', 'minimized');
            }
        }

        // --- THEME MANAGER ---
        const body = document.body;
        const themeBg = document.getElementById('theme-bg');
        //const toolbarImg = document.getElementById('toolbar-img'); // REMOVED

        const themes = {
            fl: {
                fontClass: 'font-fl', bgImage: 'flstudio.png', toolbarImage: 'bar_flstudio.png', fallbackBg: '#2d3033', text: 'text-[#d4d4d4]',
                accent: '#2f5e38', meterColor: '#f08c35', 
                vuGradient: 'conic-gradient(from 0deg at 50% 100%, transparent 0deg, transparent 130deg, #22c55e 130deg, #eab308 160deg, #ef4444 180deg)',
                cardBg: '#355e3b', cardBorder: '#2f5e38', skillsTextColor: '#fff', // Green for FL
                scanlines: false, os: 'win'
            },
            ableton: {
                fontClass: 'font-ableton', bgImage: 'ableton.png', toolbarImage: 'bar_ableton.png', fallbackBg: '#999999', text: 'text-[#333]',
                accent: '#ffbf00', meterColor: '#ffbf00', // Orange meter
                vuGradient: 'conic-gradient(from 0deg at 50% 100%, transparent 0deg, transparent 130deg, #86efac 130deg, #fde047 160deg, #fca5a5 180deg)',
                cardBg: '#ffbf00', cardBorder: '#fff', skillsTextColor: '#000', // Orange BG, Black Text
                scanlines: false, os: 'mac'
            },
            protools: {
                fontClass: 'font-protools', bgImage: 'protools.png', toolbarImage: 'bar_protools.png', fallbackBg: '#1a1a1a', text: 'text-[#e0e0e0]',
                accent: '#6232a8', meterColor: '#40b535',
                vuGradient: 'conic-gradient(from 0deg at 50% 100%, transparent 0deg, transparent 130deg, #15803d 130deg, #ca8a04 165deg, #b91c1c 180deg)',
                cardBg: 'rgba(25, 25, 35, 0.95)', cardBorder: '#6232a8',
                scanlines: false, os: 'lin'
            },
            rx: {
                fontClass: 'font-rx', bgImage: 'rx10.png', toolbarImage: 'bar_rx.png', fallbackBg: '#0b0f14', text: 'text-[#e6f1f7]',
                accent: '#3ba0e6', meterColor: '#3ba0e6',
                vuGradient: 'conic-gradient(from 0deg at 50% 100%, transparent 0deg, transparent 130deg, #fef08a 130deg, #fdba74 160deg, #fca5a5 180deg)',
                cardBg: 'rgba(10, 15, 20, 0.95)', cardBorder: '#3ba0e6',
                scanlines: true, os: 'win'
            }
        };

        function setTheme(themeName) {
            const theme = themes[themeName];
            body.className = `min-h-screen overflow-x-hidden selection:bg-opacity-30 pb-32 ${theme.fontClass}`;
            body.style.backgroundColor = theme.fallbackBg;
            themeBg.style.backgroundImage = `url('${theme.bgImage}')`;
            themeBg.style.opacity = themeName === 'ableton' ? '0.3' : '0.15';

            // Toolbar Update: Inject into .theme-bar background
            const themeWidget = document.getElementById('theme-widget');
            themeWidget.style.backgroundImage = `url('${theme.toolbarImage}')`;

            if (themeName === 'ableton') body.style.color = '#333';
            else if (themeName === 'fl') body.style.color = '#d4d4d4';
            else if (themeName === 'protools') body.style.color = '#e0e0e0';
            else if (themeName === 'rx') body.style.color = '#e6f1f7';

            // Universal Card Colors logic
            document.querySelectorAll('.theme-card').forEach(card => {
                if (themeName === 'ableton') {
                    card.style.backgroundColor = 'rgba(230, 230, 230, 0.9)';
                    card.style.borderColor = 'rgba(0,0,0,0.1)';
                    card.style.color = '#333';
                } else {
                    card.style.backgroundColor = (themeName === 'fl') ? 'rgba(40, 44, 48, 0.95)' : 'rgba(30, 30, 30, 0.9)';
                    card.style.borderColor = ''; card.style.color = '';
                }
            });

            // Specific Skills Window override based on request
            const skillsCard = document.querySelector('#skills-window .theme-card');
            if(skillsCard) {
                skillsCard.style.backgroundColor = theme.cardBg;
                skillsCard.style.borderColor = theme.cardBorder;
                skillsCard.style.borderWidth = '2px';
                
                // Text Color Override for Inverted Themes
                if(theme.skillsTextColor) {
                    skillsCard.style.color = theme.skillsTextColor;
                    skillsCard.classList.add('inverted-text'); // Helper class for specific overrides
                    if(themeName === 'ableton') skillsCard.classList.add('ableton-inverted');
                    else skillsCard.classList.remove('ableton-inverted');
                } else {
                    skillsCard.style.color = '';
                    skillsCard.classList.remove('inverted-text');
                    skillsCard.classList.remove('ableton-inverted');
                }
            }

            document.documentElement.style.setProperty('--accent-color', theme.accent);
            document.documentElement.style.setProperty('--meter-color', theme.meterColor);
            document.documentElement.style.setProperty('--vu-gradient', theme.vuGradient);

            document.querySelectorAll('.theme-icon-color').forEach(i => i.style.color = theme.accent);
            document.querySelectorAll('.theme-border-color').forEach(b => b.style.borderColor = theme.accent);
            const timeDisplay = document.getElementById('time-display');
            timeDisplay.style.color = (themeName === 'ableton') ? '#333' : theme.accent;
            timeDisplay.style.borderColor = (themeName === 'ableton') ? '#666' : 'rgba(255,255,255,0.1)';

            updateWindowControls(theme.os);
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.theme-btn[onclick*="'${themeName}'"]`).classList.add('active');
        }

        function updateWindowControls(osType) {
            const headers = document.querySelectorAll('.window-header');
            
            headers.forEach(h => {
                let section = h.closest('section');
                if(!section) section = h.closest('#skills-window');
                
                // Fallback: Check parent ID directly if section is null (e.g. skills window div)
                if(!section) {
                     let parent = h.parentElement;
                     while(parent) {
                         if(parent.id) { section = parent; break; }
                         parent = parent.parentElement;
                     }
                }
                
                const winId = section ? section.id : 'unknown';

                h.className = 'window-header';
                let btns = '';
                if (osType === 'mac') {
                    h.classList.add('ctrl-left');
                    btns = `<div class="win-ctrl-mac mac-red click-sound" onclick="handleWindowControl('close', '${winId}')"></div><div class="win-ctrl-mac mac-yel click-sound" onclick="handleWindowControl('min', '${winId}')"></div><div class="win-ctrl-mac mac-grn click-sound" onclick="handleWindowControl('max', '${winId}')"></div>`;
                } else if (osType === 'win') {
                    h.classList.add('ctrl-right');
                    btns = `<div class="win-ctrl-win click-sound" onclick="handleWindowControl('min', '${winId}')">_</div><div class="win-ctrl-win click-sound" onclick="handleWindowControl('max', '${winId}')">‚ñ°</div><div class="win-ctrl-win win-close click-sound" onclick="handleWindowControl('close', '${winId}')">‚úï</div>`;
                } else if (osType === 'lin') {
                    h.classList.add('ctrl-right');
                    btns = `<div class="win-ctrl-lin click-sound" style="border-radius:50%" onclick="handleWindowControl('min', '${winId}')"></div><div class="win-ctrl-lin click-sound" onclick="handleWindowControl('max', '${winId}')"></div><div class="win-ctrl-lin click-sound" style="background:rgba(255,255,255,0.2)" onclick="handleWindowControl('close', '${winId}')"></div>`;
                }
                h.innerHTML = btns;
            });
        }

        // --- SEQUENCER LOGIC ---
        function createStepBtn(track, index) {
            const btn = document.createElement('button');
            btn.className = `h-6 w-full rounded border border-white border-opacity-20 hover:bg-white hover:bg-opacity-20 transition step-btn bg-white bg-opacity-5 click-sound`;
            btn.onclick = () => {
                sequence[track][index] = !sequence[track][index];
                btn.classList.toggle('bg-current'); btn.classList.toggle('theme-fill');
                btn.style.backgroundColor = sequence[track][index] ? getCurrentAccent() : '';
            }; return btn;
        }
        function getCurrentAccent() { return getComputedStyle(document.documentElement).getPropertyValue('--accent-color'); }
        ['kick', 'snare', 'hat'].forEach(t => { const c = document.getElementById(`track-${t}`); for(let i=0; i<8; i++) c.appendChild(createStepBtn(t, i)); });
        
        const pCont = document.getElementById('piano-roll');
        for(let r=0; r<5; r++) {
            const l = document.createElement('div'); l.className='piano-key'; l.innerText=["Bb","G","F","Eb","C"][r]; pCont.appendChild(l);
            for(let c=0; c<8; c++) {
                const cell = document.createElement('div'); cell.className='piano-cell click-sound'; cell.id=`note-${r}-${c}`;
                cell.onclick=()=>{ melodyGrid[r][c]=!melodyGrid[r][c]; cell.classList.toggle('active'); }; pCont.appendChild(cell);
            }
        }

        // --- ACOUSTIC DRUM SYNTHESIS ---
        function playSound(type) {
            const now = audioCtx.currentTime;
            
            if(type === 'kick') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(masterGain);
                
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.5);
                gain.gain.setValueAtTime(1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                
                osc.start(now); osc.stop(now + 0.5);
                
                // Click for attack
                const clickOsc = audioCtx.createOscillator();
                const clickGain = audioCtx.createGain();
                clickOsc.connect(clickGain); clickGain.connect(masterGain);
                clickOsc.type = 'square';
                clickOsc.frequency.value = 2000; // High click
                clickGain.gain.setValueAtTime(0.2, now);
                clickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.02);
                clickOsc.start(now); clickOsc.stop(now + 0.02);
            }
            else if(type === 'snare') {
                // Body
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(masterGain);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(250, now);
                gain.gain.setValueAtTime(0.6, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);

                // Noise (Wires)
                const noiseBufferSize = audioCtx.sampleRate * 0.2; // 0.2s noise
                const buffer = audioCtx.createBuffer(1, noiseBufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < noiseBufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                const noiseGain = audioCtx.createGain();
                
                // Bandpass filter for snare "snap"
                const noiseFilter = audioCtx.createBiquadFilter();
                noiseFilter.type = 'highpass';
                noiseFilter.frequency.value = 1000;
                
                noise.connect(noiseFilter);
                noiseFilter.connect(noiseGain);
                noiseGain.connect(masterGain);
                
                noiseGain.gain.setValueAtTime(0.5, now);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                
                noise.start(now);
            }
            else if(type === 'hat') {
                // Metallic Noise Spectrum
                 const noiseBufferSize = audioCtx.sampleRate * 0.1;
                const buffer = audioCtx.createBuffer(1, noiseBufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < noiseBufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                
                const noiseFilter = audioCtx.createBiquadFilter();
                noiseFilter.type = 'highpass';
                noiseFilter.frequency.value = 5000; // Just high frequencies
                
                const noiseGain = audioCtx.createGain();
                noise.connect(noiseFilter);
                noiseFilter.connect(noiseGain);
                noiseGain.connect(masterGain);
                
                noiseGain.gain.setValueAtTime(0.3, now);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05); // Short decay
                
                noise.start(now);
            }
        }
        AudioParam.prototype.env = function(v,t,d){ this.setValueAtTime(v,t); this.exponentialRampToValueAtTime(0.01,t+d); };
        OscillatorNode.prototype.freq = function(v,t){ this.frequency.setValueAtTime(v,t); this.frequency.exponentialRampToValueAtTime(0.01,t+0.5); };

        function playSynth(f,t) {
            const o=audioCtx.createOscillator(), g=audioCtx.createGain();
            o.type='sine'; o.frequency.value=f; o.connect(g); g.connect(masterGain); 
            g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.4,t+0.02); g.gain.exponentialRampToValueAtTime(0.001,t+0.3);
            o.start(t); o.stop(t+0.3);
        }

        function togglePlay() {
            isPlaying = !isPlaying; document.getElementById('play-btn').textContent = isPlaying ? "STOP" : "PLAY";
            if(isPlaying) { if(audioCtx.state === 'suspended') audioCtx.resume(); intervalId = setInterval(nextStep, (60/bpm)*1000/2); }
            else { clearInterval(intervalId); resetVisuals(); }
        }
        function nextStep() {
            resetVisuals();
            const cols = document.querySelectorAll(`#track-kick button:nth-child(${currentStep+1}), #track-snare button:nth-child(${currentStep+1}), #track-hat button:nth-child(${currentStep+1})`);
            cols.forEach(b => b.classList.add('active'));
            for(let r=0; r<5; r++) document.getElementById(`note-${r}-${currentStep}`).classList.add('playing-col');
            
            const now = audioCtx.currentTime;
            if(sequence.kick[currentStep]) playSound('kick');
            if(sequence.snare[currentStep]) playSound('snare');
            if(sequence.hat[currentStep]) playSound('hat');
            for(let r=0; r<5; r++) if(melodyGrid[r][currentStep]) playSynth(notes[r], now);
            currentStep = (currentStep + 1) % 8;
        }
        function resetVisuals() { document.querySelectorAll('.step-btn, .piano-cell').forEach(b => b.classList.remove('active', 'playing-col')); 
            for(let r=0; r<5; r++) for(let c=0; c<8; c++) if(melodyGrid[r][c]) document.getElementById(`note-${r}-${c}`).classList.add('active');
        }
        function clearSequencer() {
            sequence.kick.fill(0); sequence.snare.fill(0); sequence.hat.fill(0); melodyGrid.forEach(r=>r.fill(false));
            document.querySelectorAll('.step-btn').forEach(b=>{b.style.backgroundColor=''; b.classList.remove('theme-fill','bg-current')});
            document.querySelectorAll('.piano-cell').forEach(c=>c.classList.remove('active'));
        }
        function changeBpm(v) { bpm=v; document.getElementById('bpm-display').textContent=v; if(isPlaying){clearInterval(intervalId); intervalId=setInterval(nextStep,(60/bpm)*1000/2);} }
        function changeKit(v) { currentKit=v; }
        function changeMasterVolume(v) { masterVolume.gain.value = v / 100; }

        // SCROLL REVEAL
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.scroll-float').forEach(el => observer.observe(el));

        setTheme('fl');
    </script>
</body>
</html>
